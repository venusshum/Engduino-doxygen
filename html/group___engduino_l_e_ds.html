<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Engduino: Driver for Engduino LEDS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Engduino.ico"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Engduino
   &#160;<span id="projectnumber">3.1.0</span>
   </div>
   <div id="projectbrief">A fun device for learning coding</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Driver for Engduino LEDS</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:_engduino_l_e_ds_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_engduino_l_e_ds_8cpp.html">EngduinoLEDs.cpp</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:_engduino_l_e_ds_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_engduino_l_e_ds_8h.html">EngduinoLEDs.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_engduino_l_e_ds_class.html">EngduinoLEDsClass</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga2134a5a06f0865c945543a1f07eba387"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2134a5a06f0865c945543a1f07eba387"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_BRIGHTNESS</b>&#160;&#160;&#160;0x0F</td></tr>
<tr class="separator:ga2134a5a06f0865c945543a1f07eba387"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gaa68e842dd7ce4ebaf9792928e4a990f0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaa68e842dd7ce4ebaf9792928e4a990f0"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><b>colour</b> { <br />
&#160;&#160;<b>RED</b>, 
<b>GREEN</b>, 
<b>BLUE</b>, 
<b>YELLOW</b>, 
<br />
&#160;&#160;<b>MAGENTA</b>, 
<b>CYAN</b>, 
<b>WHITE</b>, 
<b>OFF</b>
<br />
 }</td></tr>
<tr class="separator:gaa68e842dd7ce4ebaf9792928e4a990f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6c316c07af6042f29e718c5a5b2ea656"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga6c316c07af6042f29e718c5a5b2ea656">writeLEDs</a> (volatile uint8_t *value)</td></tr>
<tr class="memdesc:ga6c316c07af6042f29e718c5a5b2ea656"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is an internal routine to set the LED latches appropriately.  <a href="#ga6c316c07af6042f29e718c5a5b2ea656">More...</a><br /></td></tr>
<tr class="separator:ga6c316c07af6042f29e718c5a5b2ea656"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8aa6a32130ab26be17555166513a23ba"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga8aa6a32130ab26be17555166513a23ba">ISR</a> (TIMER4_COMPA_vect)</td></tr>
<tr class="memdesc:ga8aa6a32130ab26be17555166513a23ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">ISR routine for comparator A of TIMER 4.  <a href="#ga8aa6a32130ab26be17555166513a23ba">More...</a><br /></td></tr>
<tr class="separator:ga8aa6a32130ab26be17555166513a23ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeceaff5170a5076a831c697b154c00f2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaeceaff5170a5076a831c697b154c00f2"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>TIMER4_COMPA_vect</b> (void) __attribute__((signal))</td></tr>
<tr class="separator:gaeceaff5170a5076a831c697b154c00f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga37cd3409485caa6cd8712e9d70c95171"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga37cd3409485caa6cd8712e9d70c95171">EngduinoLEDsClass::EngduinoLEDsClass</a> ()</td></tr>
<tr class="memdesc:ga37cd3409485caa6cd8712e9d70c95171"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#ga37cd3409485caa6cd8712e9d70c95171">More...</a><br /></td></tr>
<tr class="separator:ga37cd3409485caa6cd8712e9d70c95171"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga288fdb1044c2685bd16f2ab7ea793e9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga288fdb1044c2685bd16f2ab7ea793e9f">EngduinoLEDsClass::begin</a> ()</td></tr>
<tr class="memdesc:ga288fdb1044c2685bd16f2ab7ea793e9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">begin function - must be called before using other functions  <a href="#ga288fdb1044c2685bd16f2ab7ea793e9f">More...</a><br /></td></tr>
<tr class="separator:ga288fdb1044c2685bd16f2ab7ea793e9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga07e877de81c2a7016ab65564f2e0b2df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga07e877de81c2a7016ab65564f2e0b2df">EngduinoLEDsClass::end</a> ()</td></tr>
<tr class="memdesc:ga07e877de81c2a7016ab65564f2e0b2df"><td class="mdescLeft">&#160;</td><td class="mdescRight">end function - switch off the LEDs  <a href="#ga07e877de81c2a7016ab65564f2e0b2df">More...</a><br /></td></tr>
<tr class="separator:ga07e877de81c2a7016ab65564f2e0b2df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga02934e20c403fc14d563fbf09d3a3b68"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga02934e20c403fc14d563fbf09d3a3b68">EngduinoLEDsClass::setLED</a> (uint8_t LEDNumber, colour c)</td></tr>
<tr class="memdesc:ga02934e20c403fc14d563fbf09d3a3b68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the colour of a single LED at maximum brightness.  <a href="#ga02934e20c403fc14d563fbf09d3a3b68">More...</a><br /></td></tr>
<tr class="separator:ga02934e20c403fc14d563fbf09d3a3b68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab354e5a76be82762e0a5c0f96abd75a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#gab354e5a76be82762e0a5c0f96abd75a6">EngduinoLEDsClass::setLED</a> (uint8_t LEDNumber, colour c, uint8_t brightness)</td></tr>
<tr class="memdesc:gab354e5a76be82762e0a5c0f96abd75a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set an LED to a given colour/brightness.  <a href="#gab354e5a76be82762e0a5c0f96abd75a6">More...</a><br /></td></tr>
<tr class="separator:gab354e5a76be82762e0a5c0f96abd75a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1c7421a4eed2e09aeda98da4a4b29483"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga1c7421a4eed2e09aeda98da4a4b29483">EngduinoLEDsClass::setLED</a> (uint8_t LEDNumber, uint8_t r, uint8_t g, uint8_t b)</td></tr>
<tr class="memdesc:ga1c7421a4eed2e09aeda98da4a4b29483"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set an LED to a given point in the rgb space.  <a href="#ga1c7421a4eed2e09aeda98da4a4b29483">More...</a><br /></td></tr>
<tr class="separator:ga1c7421a4eed2e09aeda98da4a4b29483"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga50aaa6fe93206e0fa0f037b4a7be3284"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga50aaa6fe93206e0fa0f037b4a7be3284">EngduinoLEDsClass::setAll</a> (colour c)</td></tr>
<tr class="memdesc:ga50aaa6fe93206e0fa0f037b4a7be3284"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the colour of all LEDs at maximum brightness.  <a href="#ga50aaa6fe93206e0fa0f037b4a7be3284">More...</a><br /></td></tr>
<tr class="separator:ga50aaa6fe93206e0fa0f037b4a7be3284"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0047bf22f224f1d2bfff77d04b89e89f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga0047bf22f224f1d2bfff77d04b89e89f">EngduinoLEDsClass::setAll</a> (colour c, uint8_t brightness)</td></tr>
<tr class="memdesc:ga0047bf22f224f1d2bfff77d04b89e89f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set all LEDs to a given colour/brightness.  <a href="#ga0047bf22f224f1d2bfff77d04b89e89f">More...</a><br /></td></tr>
<tr class="separator:ga0047bf22f224f1d2bfff77d04b89e89f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaddff7887dd930a0b8865c92892c0f899"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#gaddff7887dd930a0b8865c92892c0f899">EngduinoLEDsClass::setAll</a> (uint8_t r, uint8_t g, uint8_t b)</td></tr>
<tr class="memdesc:gaddff7887dd930a0b8865c92892c0f899"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set all LEDs to a given point in the rgb space.  <a href="#gaddff7887dd930a0b8865c92892c0f899">More...</a><br /></td></tr>
<tr class="separator:gaddff7887dd930a0b8865c92892c0f899"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga640f4a7798f27d483f5727baaab12c2e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga640f4a7798f27d483f5727baaab12c2e">EngduinoLEDsClass::setLEDs</a> (colour c[16])</td></tr>
<tr class="memdesc:ga640f4a7798f27d483f5727baaab12c2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the colour of all LEDs at maximum brightness from an array of individual values.  <a href="#ga640f4a7798f27d483f5727baaab12c2e">More...</a><br /></td></tr>
<tr class="separator:ga640f4a7798f27d483f5727baaab12c2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga92a706323b3e89453ee6f6b7f2057a59"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga92a706323b3e89453ee6f6b7f2057a59">EngduinoLEDsClass::setLEDs</a> (colour colour[16], uint8_t brightness[16])</td></tr>
<tr class="memdesc:ga92a706323b3e89453ee6f6b7f2057a59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set all LEDs to a given colour/brightness from arrays of individual values.  <a href="#ga92a706323b3e89453ee6f6b7f2057a59">More...</a><br /></td></tr>
<tr class="separator:ga92a706323b3e89453ee6f6b7f2057a59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga48ac99a4c0feb705368a0eecb6eb6c6d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga48ac99a4c0feb705368a0eecb6eb6c6d">EngduinoLEDsClass::setLEDs</a> (uint8_t r[16], uint8_t g[16], uint8_t b[16])</td></tr>
<tr class="memdesc:ga48ac99a4c0feb705368a0eecb6eb6c6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set all LEDs to a given point in the rgb space from arrays of individual values.  <a href="#ga48ac99a4c0feb705368a0eecb6eb6c6d">More...</a><br /></td></tr>
<tr class="separator:ga48ac99a4c0feb705368a0eecb6eb6c6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a9653a83047056363d0fca5628ed0c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga0a9653a83047056363d0fca5628ed0c9">EngduinoLEDsClass::setLEDs</a> (uint8_t rgb[3][16])</td></tr>
<tr class="memdesc:ga0a9653a83047056363d0fca5628ed0c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set all LEDs to a given point in the rgb space a 2D array of individual values. The array is of form rgb[3][16].  <a href="#ga0a9653a83047056363d0fca5628ed0c9">More...</a><br /></td></tr>
<tr class="separator:ga0a9653a83047056363d0fca5628ed0c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga41d42e2b694c6a1de7e0e53d9b85c2bb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___engduino_l_e_ds.html#ga41d42e2b694c6a1de7e0e53d9b85c2bb">EngduinoLEDsClass::setLEDs</a> (uint8_t rgb[16][3])</td></tr>
<tr class="memdesc:ga41d42e2b694c6a1de7e0e53d9b85c2bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set all LEDs to a given point in the rgb space a 2D array of individual values. The array is of form rgb[16][3].  <a href="#ga41d42e2b694c6a1de7e0e53d9b85c2bb">More...</a><br /></td></tr>
<tr class="separator:ga41d42e2b694c6a1de7e0e53d9b85c2bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga3d4bf6230e99543620a37c5f311a7121"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3d4bf6230e99543620a37c5f311a7121"></a>
<a class="el" href="class_engduino_l_e_ds_class.html">EngduinoLEDsClass</a>&#160;</td><td class="memItemRight" valign="bottom"><b>EngduinoLEDs</b> = <a class="el" href="class_engduino_l_e_ds_class.html">EngduinoLEDsClass</a>()</td></tr>
<tr class="separator:ga3d4bf6230e99543620a37c5f311a7121"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3d4bf6230e99543620a37c5f311a7121"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3d4bf6230e99543620a37c5f311a7121"></a>
<a class="el" href="class_engduino_l_e_ds_class.html">EngduinoLEDsClass</a>&#160;</td><td class="memItemRight" valign="bottom"><b>EngduinoLEDs</b></td></tr>
<tr class="separator:ga3d4bf6230e99543620a37c5f311a7121"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This is the driver code for LEDs on the Engduino These LEDS are not directly connected to pins on the AtMega32u4 processor. Instead they are connected through LED drivers so should only be accessed through this code.</p>
<p>The Engduino has 16 RGB LEDs on it, each of which can be controlled independently. To make the granularity of control greater, we implement a software PWM for each LED. This allows for 16 levels of brightness in each of the RGB channels on each LED with minimal flicker.</p>
<p>This implementation uses TIMER4 Comparator A to implement the PWM. The timer is set to run at ~320Hz. The clock is reset on interrupt, so you should be very wary about using the other comparators. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga288fdb1044c2685bd16f2ab7ea793e9f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>begin function - must be called before using other functions </p>
<p>The connection to the LEDs is not direct. Instead, it happens through three LED drivers - one each for the R, G, and B channels. These are connected through a daisy-chained SPI connection. There is a single latch line connected to all driver chips, which latches the value set by SPI when the line is pulsed high. The output from each driver chip can be switched on or off with a separate output enable line to each driver - when these are LOW the driver output lines go to the LEDs; when HIGH, they do not. </p>

</div>
</div>
<a class="anchor" id="ga07e877de81c2a7016ab65564f2e0b2df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>end function - switch off the LEDs </p>
<p>We drive the output enables for all three drivers high. This disconnects the driver from the LEDs and so all subsequent changes will have no effect. We also stop the timer interrupt. </p>

</div>
</div>
<a class="anchor" id="ga37cd3409485caa6cd8712e9d70c95171"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EngduinoLEDsClass::EngduinoLEDsClass </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<p>C++ constructor for this class. Empty. </p>

</div>
</div>
<a class="anchor" id="ga8aa6a32130ab26be17555166513a23ba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">TIMER4_COMPA_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ISR routine for comparator A of TIMER 4. </p>
<p>TIMER4 interrupt code ticks at ~320Hz, which means we can do 16 brightness levels at 20Hz, so flickering is invisible to the naked eye. This ISR implements the software PWM and calls the LED display function.</p>
<p>Because we must update the LEDs very frequently, and because it still takes a significant period to write all 3*16 values to the LED drivers, we need this code to run as fast as possible. We also need to ensure that we do not prevent other interrupts from occurring whilst we process this. To that end we stop interrupts for this ISR to prevent any nesting, reset the counter and re-enable interrupts generally before calling setting the LED values.</p>
<p>The PWM implementation relies on counting in units of the brightness on a channel and setting the apropriate colour channel on for an LED when the accumulated value overflows. This is slightly faster if the rgb values are in the range 0-255 than 0-15, because we can do it with a simple comparison.</p>
<p>This function then calls writeLEDs for each of the RGB values, in reverse order. The drivers are daisy chained and we need to shift the blue values to the far end of that chain before pulsing the latch. This written using low level C programming primitives of changing the voltages on ATMega32U4 pins rather than the Arduino digitalWrite equivalents. This has to be done in this way for speed - it is around 18 times faster than the alternative and, because we update the values rather frequently to avoid flickering, speed is important.</p>
<p>Notes: The PWM implementation will occasionally put one more dark period in than it should, but we can live with this for simplicity. PB7 is pin 12 on the ATMega32U4 and is attached to the LED LATCH </p>

</div>
</div>
<a class="anchor" id="ga50aaa6fe93206e0fa0f037b4a7be3284"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setAll </td>
          <td>(</td>
          <td class="paramtype">colour&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the colour of all LEDs at maximum brightness. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">c</td><td>Colour, as chosen from the colour enum</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour of all LEDs. The colour value here is chosen from an enum and corresponds to the primary and secondary colours of light, plus white and off. </p>

</div>
</div>
<a class="anchor" id="ga0047bf22f224f1d2bfff77d04b89e89f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setAll </td>
          <td>(</td>
          <td class="paramtype">colour&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>brightness</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set all LEDs to a given colour/brightness. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">c</td><td>Colour, as chosen from the colour enum </td></tr>
    <tr><td class="paramname">brightness</td><td>A 0-MAX_BRIGHTNESS(=15) value</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour of all LEDs. The colour value here is chosen from an enum and corresponds to the primary and secondary colours of light, plus white and off. Brightness ranges from 0 to MAX_BRIGHTNESS (currently 15). Choosing a brightness of zero will turn all LEDs off. </p>

</div>
</div>
<a class="anchor" id="gaddff7887dd930a0b8865c92892c0f899"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setAll </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set all LEDs to a given point in the rgb space. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>Brightness of the red channel from 0-MAX_BRIGHTNESS (15) </td></tr>
    <tr><td class="paramname">g</td><td>Brightness of the green channel from 0-MAX_BRIGHTNESS (15) </td></tr>
    <tr><td class="paramname">b</td><td>Brightness of the blue channel from 0-MAX_BRIGHTNESS (15)</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour/brightness of all LEDs to a point in rgb space. The brightness in each channel may range from 0 to MAX_BRIGHTNESS (currently 15).</p>
<p>Note: in the Engduino 1.0, we cannot use the full brightness for the LEDs when the colour white, or colours close to white are requested, simply because this causes too big a drain on current whilst the device is attached to the USB. This causes a system reset, which is both irritating and makes reprogramming rather tedious. So we limit the sum of the rgb values to a number we chose empirically, and we reduce the chosen rgb values until they sum to less than that chosen. </p>

</div>
</div>
<a class="anchor" id="ga02934e20c403fc14d563fbf09d3a3b68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setLED </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>LEDNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">colour&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the colour of a single LED at maximum brightness. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">LEDNumber</td><td>LED number, ranging from 0 (for LED0) to 15 (LED15) </td></tr>
    <tr><td class="paramname">c</td><td>Colour, as chosen from the colour enum</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour of an LED. The colour value here is chosen from an enum and corresponds to the primary and secondary colours of light, plus white and off. </p>

</div>
</div>
<a class="anchor" id="gab354e5a76be82762e0a5c0f96abd75a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setLED </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>LEDNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">colour&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>brightness</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set an LED to a given colour/brightness. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">LEDNumber</td><td>LED number, ranging from 0 (for LED0) to 15 (LED15) </td></tr>
    <tr><td class="paramname">c</td><td>Colour, as chosen from the colour enum </td></tr>
    <tr><td class="paramname">brightness</td><td>A 0-MAX_BRIGHTNESS(=15) value</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour of an LED. The colour value here is chosen from an enum and corresponds to the primary and secondary colours of light, plus white and off. Brightness ranges from 0 to MAX_BRIGHTNESS (currently 15). Choosing a brightness of zero will turn an LED off. </p>

</div>
</div>
<a class="anchor" id="ga1c7421a4eed2e09aeda98da4a4b29483"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setLED </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>LEDNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set an LED to a given point in the rgb space. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">LEDNumber</td><td>LED number, ranging from 0 (for LED0) to 15 (LED15) </td></tr>
    <tr><td class="paramname">r</td><td>Brightness of the red channel from 0-MAX_BRIGHTNESS (15) </td></tr>
    <tr><td class="paramname">g</td><td>Brightness of the green channel from 0-MAX_BRIGHTNESS (15) </td></tr>
    <tr><td class="paramname">b</td><td>Brightness of the blue channel from 0-MAX_BRIGHTNESS (15)</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour/brightness of an LED to a point in rgb space. The brightness in each channel may range from 0 to MAX_BRIGHTNESS (currently 15).</p>
<p>Note: in the Engduino 1.0, we cannot use the full brightness for the LEDs when the colour white, or colours close to white are requested, simply because this causes too big a drain on current whilst the device is attached to the USB. This causes a system reset, which is both irritating and makes reprogramming rather tedious. So we limit the sum of the rgb values to a number we chose empirically, and we reduce the chosen rgb values until they sum to less than that chosen. </p>

</div>
</div>
<a class="anchor" id="ga640f4a7798f27d483f5727baaab12c2e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setLEDs </td>
          <td>(</td>
          <td class="paramtype">colour&#160;</td>
          <td class="paramname"><em>c</em>[16]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the colour of all LEDs at maximum brightness from an array of individual values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">c</td><td>Array of colour values, as chosen from the colour enum</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour of all LEDs from an array of colour values - i.e. each LED can be set to a different colour, though all are at maximum brightness. The colour value here is chosen from an enum and corresponds to the primary and secondary colours of light, plus white and off. </p>

</div>
</div>
<a class="anchor" id="ga92a706323b3e89453ee6f6b7f2057a59"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setLEDs </td>
          <td>(</td>
          <td class="paramtype">colour&#160;</td>
          <td class="paramname"><em>c</em>[16], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>brightness</em>[16]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set all LEDs to a given colour/brightness from arrays of individual values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">c</td><td>Array of colour values, as chosen from the colour enum </td></tr>
    <tr><td class="paramname">brightness</td><td>Array of brightness values, from 0-MAX_BRIGHTNESS(=15)</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour/brightness of all LEDs from two arrays of values - i.e. each LED can be set to a different colour/brightness value. The colour value here is chosen from an enum and corresponds to the primary and secondary colours of light, plus white and off. Brightness ranges from 0 to MAX_BRIGHTNESS (currently 15). Choosing a brightness of zero will turn an LED off. </p>

</div>
</div>
<a class="anchor" id="ga48ac99a4c0feb705368a0eecb6eb6c6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setLEDs </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>r</em>[16], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>g</em>[16], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>b</em>[16]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set all LEDs to a given point in the rgb space from arrays of individual values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>Array of red channel brightness, from 0-MAX_BRIGHTNESS (15) </td></tr>
    <tr><td class="paramname">g</td><td>Array of green channel brightness, from 0-MAX_BRIGHTNESS (15) </td></tr>
    <tr><td class="paramname">b</td><td>Array of blue channel brightness, from 0-MAX_BRIGHTNESS (15)</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour/brightness of all LEDs to a point in rgb space from three arrays of values - i.e. each LED can be set to a different rgb point. The brightness in each channel may range from 0 to MAX_BRIGHTNESS (currently 15).</p>
<p>Note: in the Engduino 1.0, we cannot use the full brightness for the LEDs when the colour white, or colours close to white are requested, simply because this causes too big a drain on current whilst the device is attached to the USB. This causes a system reset, which is both irritating and makes reprogramming rather tedious. So we limit the sum of the rgb values to a number we chose empirically, and we reduce the chosen rgb values until they sum to less than that chosen. </p>

</div>
</div>
<a class="anchor" id="ga0a9653a83047056363d0fca5628ed0c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setLEDs </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rgb</em>[3][16]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set all LEDs to a given point in the rgb space a 2D array of individual values. The array is of form rgb[3][16]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rgb</td><td>2D array of rgb brightnesses, from 0-MAX_BRIGHTNESS (15)</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour/brightness of all LEDs to a point in rgb space from a 2D array values - i.e. each LED can be set to a different rgb point. The array is of form rgb[3][16] - i.e. the first index is the red/green/blue channel and the second is the LED (ranging from 0-15). The brightness in each channel may range from 0 to MAX_BRIGHTNESS (currently 15).</p>
<p>Note: in the Engduino 1.0, we cannot use the full brightness for the LEDs when the colour white, or colours close to white are requested, simply because this causes too big a drain on current whilst the device is attached to the USB. This causes a system reset, which is both irritating and makes reprogramming rather tedious. So we limit the sum of the rgb values to a number we chose empirically, and we reduce the chosen rgb values until they sum to less than that chosen. </p>

</div>
</div>
<a class="anchor" id="ga41d42e2b694c6a1de7e0e53d9b85c2bb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EngduinoLEDsClass::setLEDs </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rgb</em>[16][3]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set all LEDs to a given point in the rgb space a 2D array of individual values. The array is of form rgb[16][3]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rgb</td><td>2D array of rgb brightnesses, from 0-MAX_BRIGHTNESS (15)</td></tr>
  </table>
  </dd>
</dl>
<p>Set the colour/brightness of all LEDs to a point in rgb space from a 2D array values - i.e. each LED can be set to a different rgb point. The array is of form rgb[16][3] - i.e. the first index is the LED (ranging from 0-15). and the second is the red/green/blue channel. The brightness in each channel may range from 0 to MAX_BRIGHTNESS (currently 15).</p>
<p>Note: in the Engduino 1.0, we cannot use the full brightness for the LEDs when the colour white, or colours close to white are requested, simply because this causes too big a drain on current whilst the device is attached to the USB. This causes a system reset, which is both irritating and makes reprogramming rather tedious. So we limit the sum of the rgb values to a number we chose empirically, and we reduce the chosen rgb values until they sum to less than that chosen. </p>

</div>
</div>
<a class="anchor" id="ga6c316c07af6042f29e718c5a5b2ea656"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void writeLEDs </td>
          <td>(</td>
          <td class="paramtype">volatile uint8_t *&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This is an internal routine to set the LED latches appropriately. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">value</td><td>The on/off bits for each LED on a given channel</td></tr>
  </table>
  </dd>
</dl>
<p>This function sends two SPI 8bit packages to simulate 16bit SPI package.</p>
<p>Notes: PB1 is pin 9 - SPI SCLK PB2 is pin 10 - SPI MOSI PB3 is pin 11 - SPI MISO </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 29 2015 17:37:08 for Engduino by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
